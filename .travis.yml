sudo: false

matrix:
  allow_failures:
    - python: nightly

  include:
    - os: linux
      python: 3.6.0

    - os: linux
      python: 3.6.1
      env: DEPLOY_DOCS=1

    - os: linux
      python: 3.6

    - os: linux
      python: nightly

language: python

install:
  - pip install pip setuptools --upgrade
  - pip install .[dev]
  - pip install -U pycodestyle mypy
  - pip install coveralls

script:
  - mypy --python-version 3.6 --disallow-untyped-calls --disallow-untyped-defs
    --warn-unused-ignores --show-traceback --strict-optional --ignore-missing-imports
    --follow-imports=skip --show-error-context --show-traceback -p sketchbook
  - pycodestyle --show-source sketchbook
  - coverage run --source=sketchbook setup.py test
  - sphinx-versioning build -r master docs docs/_build/html

after_success:
  - coveralls

before_deploy:
  - cd docs/_build/html

deploy:
  provider: s3
  access_key_id: AKIAJOZQYM7VD6BOZHCA
  secret_access_key:
    secure: "pz7jvSHiTjtym6Z+wXvYItSPrep09mWa5rBCtiDg3zAt4kvSVfrxK52WVElUCOLm2FPlOOpBYbMwWiIavmaGkP78Zq3wFbmbLLYTgMeStHbET7vViRbrNsghUyAsmO4savufYa6XSOcA0QKU8aD4UGzN23vvNfSkEzpdCu5GOX5Gc+OXYbzjHU38xeyTlMVtSMa3+rvWn8ZiXCu73I4pbYgD+D9FIEBH1ry5sE+xdvj8oo/r4ChVggaKEBeZjEXZqFru5Yf2O8ay185EU9IVPZU8laWnG5/kKRiT0PC/JK+ovoi5T+h6O5jAySi0RW5GaSMJ2XrT6tOgVjr+M+MtUjtRYVVMAoTbxYKV7Y5tzCi8QBQOv4IbDn7ylURMC1z4wFCx8d0jdttf9/khXHSw0Lwr5OrdbcImoo/88j8eZozsslE2ImPtXyMXhfZ2j1RDFMZnLf9K5k0Gewcdst8JkM6HApD04Z/z/4IcP1HJNliju6H4uZFhx76JzLXxhF4PNTGIZYZQxVUMr7RA1bR6pZ2Kr0AAOAV0aX4SQAau/S48LZO+24NgYopSJ4wFaNnROV3CUzsvmJ9Cu9s1T7RKrpK7NbY9i3irKZgo0KWTJYoTVeJrzKSq8/baXTDQvAe3hJPcJkZcXXjZpNXWCBvDdwP+0Nrk95fizypzYNyVKWE="
  bucket: "sketchbook-docs"
  skip_cleanup: true
  on:
    branch: master
    condition: "$DEPLOY_DOCS = 1"
  region: eu-west-2
